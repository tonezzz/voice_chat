x-build-cache: &build_cache
  cache_from:
    - type=local,src=${DOCKER_CACHE_DIR:-.docker-cache}
  cache_to:
    - type=local,dest=${DOCKER_CACHE_DIR:-.docker-cache},mode=max

services:
  ollama:
    volumes:
      - ${OLLAMA_DATA_ROOT:-/data/models/ollama}:/root/.ollama

  ollama-gpu:
    volumes:
      - ${OLLAMA_DATA_ROOT:-/data/models/ollama}:/root/.ollama

  stt:
    volumes:
      - ${HF_STT_MODELS:-/data/models/huggingface/stt}:/app/models

  stt-gpu:
    build:
      context: ./stt
      <<: *build_cache
      args:
        BASE_IMAGE: ${CUDA_BASE_IMAGE:-nvidia/cuda:12.4.1-runtime-ubuntu22.04}
    volumes:
      - ${HF_STT_MODELS:-/data/models/huggingface/stt}:/app/models

  mcp_yolo:
    build:
      context: ./mcp_yolo
      <<: *build_cache
      args:
        BASE_IMAGE: ${CUDA_BASE_IMAGE:-nvidia/cuda:12.4.1-runtime-ubuntu22.04}
    volumes:
      - ${YOLO_MODEL_ROOT:-/data/models/yolo}:/app/models
